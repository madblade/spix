{"version":3,"sources":["../../../../../../server/app/engine/game3d/engine_consistency/buffer_entity.js"],"names":[],"mappings":";;;;AAIA;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAEM;AAEF,aAFE,YAEF,GAAc;4CAFZ,cAEY;;AACV,aAAK,aAAL,GAAqB,mBAArB,CADU;AAEV,aAAK,eAAL,GAAuB,mBAAvB,CAFU;AAGV,aAAK,aAAL,GAAqB,mBAArB,CAHU;KAAd;;+BAFE;;oCAWU,QAAQ;AAChB,gBAAI,iBAAiB,KAAK,eAAL,CADL;AAEhB,gBAAI,KAAK,OAAO,MAAP,CAAc,EAAd,CAFO;AAGhB,gBAAI,eAAe,GAAf,CAAmB,EAAnB,CAAJ,EAA4B,eAAe,MAAf,CAAsB,EAAtB,EAA5B,KACK,KAAK,aAAL,CAAmB,GAAnB,CAAuB,EAAvB,EADL;;;;qCAIS,UAAU;AACnB,gBAAI,eAAe,KAAK,aAAL,CADA;AAEnB,gBAAI,aAAa,GAAb,CAAiB,QAAjB,CAAJ,EAAgC,aAAa,MAAb,CAAoB,QAApB,EAAhC,KACK,KAAK,eAAL,CAAqB,GAArB,CAAyB,QAAzB,EADL;;;;;;;;gDAMoB,UAAU,eAAe,iBAAiB;;AAE9D,gBAAI,CAAC,aAAD,IAAkB,CAAC,eAAD,EAAkB,OAAxC;AACA,gBAAI,iBAAiB,eAAjB,EAAkC,sBAAc,aAAd,EAA6B,eAA7B;AAAtC,iBACK,IAAI,eAAJ,EAAqB,gBAAgB,eAAhB,CAArB;;;AAJyD,gBAO9D,CAAK,aAAL,CAAmB,GAAnB,CAAuB,QAAvB,EAAiC,aAAjC,EAP8D;;;;;;;oCAWtD;AACR,mBAAO,kBAAQ,KAAK,aAAL,CAAf,CADQ;;;;gCAIJ;AACJ,iBAAK,aAAL,GAAqB,mBAArB,CADI;AAEJ,iBAAK,eAAL,GAAuB,mBAAvB,CAFI;AAGJ,iBAAK,aAAL,GAAqB,mBAArB,CAHI;;;;4BAjCgB;AAAE,mBAAO,KAAK,aAAL,CAAT;;;;4BACA;AAAE,mBAAO,KAAK,eAAL,CAAT;;;WATtB;;;kBAiDS","file":"buffer_entity.js","sourcesContent":["/**\n *\n */\n\n'use strict';\n\nclass EntityBuffer {\n\n    constructor() {\n        this._addedPlayers = new Set();\n        this._removedPlayers = new Set();\n        this._outputBuffer = new Map();\n    }\n\n    get addedPlayers()      { return this._addedPlayers; }\n    get removedPlayers()    { return this._removedPlayers; }\n\n    spawnPlayer(player) {\n        let removedPlayers = this._removedPlayers;\n        let id = player.avatar.id;\n        if (removedPlayers.has(id)) removedPlayers.delete(id);\n        else this._addedPlayers.add(id);\n    }\n\n    removePlayer(playerId) {\n        let addedPlayers = this._addedPlayers;\n        if (addedPlayers.has(playerId)) addedPlayers.delete(playerId);\n        else this._removedPlayers.add(playerId);\n    }\n\n    // addedEntities:   entity id => {p:e.position, r:e.rotation, k:e.kind}\n    // removedEntities: entity id => null\n    updateEntitiesForPlayer(playerId, addedEntities, removedEntities) {\n        // Check.\n        if (!addedEntities && !removedEntities) return;\n        if (addedEntities && removedEntities) Object.assign(addedEntities, removedEntities); // Aggregate.\n        else if (removedEntities) addedEntities = removedEntities;\n\n        // Output.\n        this._outputBuffer.set(playerId, addedEntities);\n    }\n\n    // Shallow.\n    getOutput() {\n        return new Map(this._outputBuffer);\n    }\n\n    flush() {\n        this._addedPlayers = new Set();\n        this._removedPlayers = new Set();\n        this._outputBuffer = new Map();\n    }\n\n}\n\nexport default EntityBuffer;\n"]}