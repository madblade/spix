{"version":3,"sources":["../../../../../../../server/app/engine/game3d/engine_consistency/generator/generator_simple_perlin.js"],"names":[],"mappings":"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","file":"generator_simple_perlin.js","sourcesContent":["/**\n *\n */\n\n'use strict';\n\nclass SimplePerlin {\n\n    constructor() {\n        this.p = [ 151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,\n            23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,\n            174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,\n            133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,\n            89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,\n            202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,\n            248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,\n            178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,\n            14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,\n            93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180 ];\n\n        for (var i = 0; i < 256 ; ++i) {\n            this.p[256 + i] = this.p[i];\n        }\n    }\n\n    static fade(t) {\n        return t * t * t * (t * (t * 6 - 15) + 10);\n    }\n\n    static lerp(t, a, b) {\n        return a + t * (b - a);\n    }\n\n    static grad(hash, x, y, z) {\n        var h = hash & 15;\n        var u = h < 8 ? x : y, v = h < 4 ? y : h == 12 || h == 14 ? x : z;\n        return ((h&1) == 0 ? u : -u) + ((h&2) == 0 ? v : -v);\n    }\n\n    noise(x, y, z){\n        let fade = SimplePerlin.fade;\n        let lerp = SimplePerlin.lerp;\n        let grad = SimplePerlin.grad;\n        let p = this.p;\n\n        let floorX = Math.floor(x),\n            floorY = Math.floor(y),\n            floorZ = Math.floor(z);\n\n        let X = floorX & 255,\n            Y = floorY & 255,\n            Z = floorZ & 255;\n\n        x -= floorX;\n        y -= floorY;\n        z -= floorZ;\n\n        let xMinus1 = x - 1,\n            yMinus1 = y - 1,\n            zMinus1 = z - 1;\n\n        let u = fade(x),\n            v = fade(y),\n            w = fade(z);\n\n        let A = p[X] + Y,\n            AA = p[A] + Z,\n            AB = p[A + 1] + Z,\n\n            B = p[X + 1] + Y,\n            BA = p[B] + Z,\n            BB = p[B + 1] + Z;\n\n        return lerp(w,\n            lerp(v,\n                lerp(u, grad(p[AA], x, y, z), grad(p[BA], xMinus1, y, z)),\n                lerp(u, grad(p[AB], x, yMinus1, z), grad(p[BB], xMinus1, yMinus1, z))),\n\n            lerp(v,\n                lerp(u, grad(p[AA + 1], x, y, zMinus1), grad(p[BA + 1], xMinus1, y, z - 1)),\n                lerp(u, grad(p[AB + 1], x, yMinus1, zMinus1), grad(p[BB + 1], xMinus1, yMinus1, zMinus1)))\n        );\n    }\n\n    static simplePerlinGeneration(chunk, shuffleChunks, worldId) {\n        let dims = chunk.dimensions;\n        const dx = dims[0], dy = dims[1], dz = dims[2];\n        const ci = chunk.chunkI, cj = chunk.chunkJ, ck = chunk.chunkK;\n        const offsetX = dx*ci, offsetY = dy*cj, offsetZ = dz*ck;\n\n        // Fill with grass on main world, sand everywhere else.\n        const mainBlockId = (worldId == -1 ? 1 : 17);\n\n        let perlin = new SimplePerlin();\n        let blocks = new Uint8Array(dx * dy * dz);\n\n        var data = [];\n        let quality = 2;\n        const ijS = dx * dy;\n        const z = shuffleChunks ? Math.random()*100 : 50;\n\n        for (var j = 0; j < 4; ++j) {\n\n            if (j === 0) for (let i = 0; i < ijS; ++i) data[i] = 0;\n\n            for (let i = 0; i < ijS; ++i) {\n                let x = offsetX + (i % dx),\n                    y = offsetY + ((i / dx) | 0);\n                data[i] += perlin.noise(x / quality, y / quality, z) * quality;\n            }\n\n            quality *= 4;\n        }\n\n        function getY(x, y) {\n            return ( data[ x + y * dx ] * 0.2 ) | 0;\n        }\n\n        for (let x = 0; x < dx; ++x) {\n            for (let y = 0; y < dy; ++y) {\n                let h = 16 + getY(x, y);\n                const rock = Math.floor(5*h/6);\n                let xy = x + y*dx;\n\n                for (let zz = 0; zz < rock; ++zz) {\n                    // Rock.\n                    blocks[ijS*zz+xy] = 2;\n\n                    // Iron.\n                    if (Math.random() > 0.99) blocks[ijS*zz+xy] = 18;\n                }\n\n                // Grass.\n                for (let zz = rock; zz < h; ++zz) {\n                    blocks[ijS*zz+xy] = mainBlockId;\n                }\n            }\n        }\n\n        chunk.blocks = blocks;\n    }\n\n}\n\nexport default SimplePerlin;\n"]}