{"version":3,"sources":["../../../../../../../server/app/engine/game3d/engine_topology/updater/updater_access.js"],"names":[],"mappings":";;;;AAIA;;;;;;;;;;;;;;;;;;AAEA;;;;AACA;;;;;;IAEM;;;;;;;iCAEc,cAAc,GAAG,GAAG,GAAG,SAAS,OAAO,aACvD;AACI,gBAAM,OAAO,MAAM,KAAN;gBAAa,OAAO,MAAM,KAAN;gBAAa,OAAO,MAAM,KAAN,CADzD;AAEI,gBAAI,mBAAmB,MAAM,mBAAN,CAA0B,CAA1B,EAA6B,CAA7B,EAAgC,CAAhC,CAAnB,CAFR;AAGI,gBAAI,QAAQ,MAAM,QAAN,+CAAkB,iBAAlB,CAAR,CAHR;;AAKI,gBAAI,WAAW,CAAC,KAAK,CAAL,GAAS,CAAT,GAAa,OAAM,CAAE,CAAD,GAAI,IAAL,CAApB,GAAkC,IAAlC,CALnB;AAMI,gBAAI,WAAW,CAAC,KAAK,CAAL,GAAS,CAAT,GAAa,OAAM,CAAE,CAAD,GAAI,IAAL,CAApB,GAAkC,IAAlC,CANnB;AAOI,gBAAI,WAAW,CAAC,KAAK,CAAL,GAAS,CAAT,GAAa,OAAM,CAAE,CAAD,GAAI,IAAL,CAApB,GAAkC,IAAlC,CAPnB;;AASI,gBAAI,gBAAgB,CAAC,QAAD,EAAW,QAAX,EAAqB,QAArB,CAAhB,CATR;;AAWI,qBAAS,OAAT,CAAiB,MAAjB,EAAyB;AAAE,wBAAQ,GAAR,CAAY,qBAAqB,MAArB,CAAZ,CAAF;aAAzB;;AAEA,gBAAI,CAAC,cAAc,oBAAd,CAAmC,YAAnC,EAAiD,CAAjD,EAAoD,CAApD,EAAuD,CAAvD,CAAD,EAA4D;AAC5D,wBAAQ,qCAAR,EAD4D;AAE5D,uBAF4D;aAAhE;;AAKA,gBAAI,MAAM,IAAN,cAAc,aAAd,MAAiC,CAAjC,EAAoC;AACpC,wBAAQ,0CAAR,EADoC;AAEpC,uBAFoC;aAAxC;;AAKA,gBAAI,YAAY,mBAAZ,CAAgC,CAAhC,EAAmC,CAAnC,EAAsC,CAAtC,CAAJ,EACA;AACI,wBAAQ,oCAAR,EADJ;AAEI,uBAAO,KAAP,CAFJ;aADA;;AAMA,oBAAQ,cAAU,gBAAe,SAAjC,CA7BJ;;;;iCAgCgB,cAAc,GAAG,GAAG,GAAG,OAAO,aAC9C;;AAEI,gBAAM,OAAO,MAAM,KAAN;gBAAa,OAAO,MAAM,KAAN;gBAAa,OAAO,MAAM,KAAN,CAFzD;AAGI,gBAAI,mBAAmB,MAAM,mBAAN,CAA0B,CAA1B,EAA6B,CAA7B,EAAgC,CAAhC,CAAnB,CAHR;AAII,gBAAI,QAAQ,MAAM,QAAN,+CAAkB,iBAAlB,CAAR,CAJR;;AAMI,gBAAI,WAAW,CAAC,KAAK,CAAL,GAAS,CAAT,GAAa,OAAM,CAAE,CAAD,GAAI,IAAL,CAApB,GAAkC,IAAlC,CANnB;AAOI,gBAAI,WAAW,CAAC,KAAK,CAAL,GAAS,CAAT,GAAa,OAAM,CAAE,CAAD,GAAI,IAAL,CAApB,GAAkC,IAAlC,CAPnB;AAQI,gBAAI,WAAW,CAAC,KAAK,CAAL,GAAS,CAAT,GAAa,OAAM,CAAE,CAAD,GAAI,IAAL,CAApB,GAAkC,IAAlC,CARnB;;AAUI,gBAAI,gBAAgB,CAAC,QAAD,EAAW,QAAX,EAAqB,QAArB,CAAhB;;;AAVR,qBAaa,OAAT,CAAiB,MAAjB,EAAyB;AAAE,wBAAQ,GAAR,CAAY,qBAAqB,MAArB,CAAZ,CAAF;aAAzB;;AAEA,gBAAI,CAAC,cAAc,oBAAd,CAAmC,YAAnC,EAAiD,CAAjD,EAAoD,CAApD,EAAuD,CAAvD,CAAD,EAA4D;AAC5D,wBAAQ,qCAAR,EAD4D;AAE5D,uBAF4D;aAAhE;;AAKA,gBAAI,MAAM,IAAN,cAAc,aAAd,MAAiC,CAAjC,EAAoC;AACpC,wBAAQ,+BAAR,EADoC;AAEpC,uBAFoC;aAAxC;;AAKA,oBAAQ,cAAU,cAAlB,CAzBJ;;;;6CA4B4B,cAAc,GAAG,GAAG,GAAG;;AAE/C,gBAAM,KAAK,mBAAc,kBAAd,CAAiC,aAAa,QAAb,EAAuB,CAAC,IAAE,EAAF,EAAM,IAAE,EAAF,EAAM,IAAE,EAAF,CAArE,CAAL,CAFyC;AAG/C,mBAAQ,KAAK,EAAL,CAHuC;;;WAhEjD;;;kBAwES","file":"updater_access.js","sourcesContent":["/**\n *\n */\n\n'use strict';\n\nimport GeometryUtils    from '../../../math/geometry';\nimport NumberUtils      from '../../../math/numbers';\n\nclass UpdaterAccess {\n\n    static addBlock(originEntity, x, y, z, blockId, world, entityModel)\n    {\n        const dimX = world.xSize, dimY = world.ySize, dimZ = world.zSize;\n        let chunkCoordinates = world.getChunkCoordinates(x, y, z);\n        let chunk = world.getChunk(...chunkCoordinates);\n\n        let xOnChunk = (x >= 0 ? x : dimX-((-x)%dimX)) % dimX;\n        let yOnChunk = (y >= 0 ? y : dimY-((-y)%dimY)) % dimY;\n        let zOnChunk = (z >= 0 ? z : dimZ-((-z)%dimZ)) % dimZ;\n\n        let coordsOnChunk = [xOnChunk, yOnChunk, zOnChunk];\n\n        function failure(reason) { console.log('Request denied: ' + reason); }\n\n        if (!UpdaterAccess.validateBlockEdition(originEntity, x, y, z)) {\n            failure('Requested location is too far away.');\n            return;\n        }\n\n        if (chunk.what(...coordsOnChunk) !== 0) {\n            failure('Cannot add a block on a non-empty block.');\n            return;\n        }\n\n        if (entityModel.anEntityIsPresentOn(x, y, z))\n        {\n            failure('An entity is present on the block.');\n            return false;\n        }\n\n        return [chunk, ...coordsOnChunk, blockId];\n    }\n\n    static delBlock(originEntity, x, y, z, world, entityModel)\n    {\n        // Translate.\n        const dimX = world.xSize, dimY = world.ySize, dimZ = world.zSize;\n        let chunkCoordinates = world.getChunkCoordinates(x, y, z);\n        let chunk = world.getChunk(...chunkCoordinates);\n\n        let xOnChunk = (x >= 0 ? x : dimX-((-x)%dimX)) % dimX;\n        let yOnChunk = (y >= 0 ? y : dimY-((-y)%dimY)) % dimY;\n        let zOnChunk = (z >= 0 ? z : dimZ-((-z)%dimZ)) % dimZ;\n\n        let coordsOnChunk = [xOnChunk, yOnChunk, zOnChunk];\n\n        // Validate.\n        function failure(reason) { console.log('Request denied: ' + reason); }\n\n        if (!UpdaterAccess.validateBlockEdition(originEntity, x, y, z)) {\n            failure('requested location is too far away.');\n            return;\n        }\n\n        if (chunk.what(...coordsOnChunk) === 0) {\n            failure('Cannot delete an empty block.');\n            return;\n        }\n\n        return [chunk, ...coordsOnChunk];\n    }\n\n    static validateBlockEdition(originEntity, x, y, z) {\n        // 10 blocks maximum range for block editing.\n        const d3 = GeometryUtils.euclideanDistance3(originEntity.position, [x+.5, y+.5, z+.5]);\n        return (d3 < 10);\n    }\n\n}\n\nexport default UpdaterAccess;\n"]}