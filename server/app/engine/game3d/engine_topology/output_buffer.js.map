{"version":3,"sources":["../../../../../../server/app/engine/game3d/engine_topology/output_buffer.js"],"names":[],"mappings":";;;;;AAKA;;;;;;;;;;;;;;;;;;;;;;;;IAEM;AAEF,aAFE,YAEF,GAAc;4CAFZ,cAEY;;;;;;AAKV,aAAK,OAAL,GAAe,mBAAf,CALU;KAAd;;+BAFE;;qCAUW,SAAS,SAAS;AAC3B,gBAAI,WAAW,KAAK,OAAL,CAAa,GAAb,CAAiB,OAAjB,CAAX,CADuB;AAE3B,gBAAI,QAAJ,EAAc;AACV,yBAAS,GAAT,CAAa,OAAb,EADU;aAAd,MAEO;AACH,oBAAI,aAAa,mBAAb,CADD;AAEH,2BAAW,GAAX,CAAe,OAAf,EAFG;AAGH,qBAAK,OAAL,CAAa,GAAb,CAAiB,OAAjB,EAA0B,UAA1B,EAHG;aAFP;;;;;;;oCAUQ;AACR,mBAAO,kBAAQ,KAAK,OAAL,CAAf,CADQ;;;;oCAIA,YAAY;AACpB,gBAAI,SAAS,KAAK,OAAL,CADO;;AAGpB,mBAAO,OAAP,CAAe,UAAC,QAAD,EAAW,OAAX,EAAuB;AAClC,oBAAI,SAAS,WAAW,QAAX,CAAoB,OAApB,EAA6B,SAA7B,CADqB;AAElC,yBAAS,OAAT,CACI;2BAAM,OAAO,GAAP,CAAW,EAAX,EAAe,YAAf;iBAAN,CADJ,CAFkC;aAAvB,CAAf,CAHoB;;AAUpB,iBAAK,OAAL,GAAe,mBAAf,CAVoB;;;WA1BtB;;;kBAyCS","file":"output_buffer.js","sourcesContent":["/**\n * Aggregate updates.\n * Specialized for world model.\n */\n\n'use strict';\n\nclass OutputBuffer {\n\n    constructor() {\n        // Contains ids of updated chunks.\n        // Chunks themselves hold information about their being updated.\n        // TODO [LOW] concentrate chunk updates in this buffer.\n        // world id => Set(... chunk ids)\n        this._buffer = new Map();\n    }\n\n    chunkUpdated(worldId, chunkId) {\n        let worldSet = this._buffer.get(worldId);\n        if (worldSet) {\n            worldSet.add(chunkId);\n        } else {\n            let chunkIdSet = new Set();\n            chunkIdSet.add(chunkId);\n            this._buffer.set(worldId, chunkIdSet);\n        }\n    }\n\n    // Shallow copy.\n    getOutput() {\n        return new Map(this._buffer);\n    }\n\n    flushOutput(worldModel) {\n        let buffer = this._buffer;\n\n        buffer.forEach((chunkSet, worldId) => {\n            let chunks = worldModel.getWorld(worldId).allChunks;\n            chunkSet.forEach(\n                id => chunks.get(id).flushUpdates()\n            );\n        });\n\n        this._buffer = new Map();\n    }\n\n}\n\nexport default OutputBuffer;\n"]}